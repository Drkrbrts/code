<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- #region Sabio Code - You can Fold this region to remove it from sight -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="referrer" content="unsafe-url" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png" />
    <link rel="shortcut icon" href="https://sabio.la/Sabio.png" />
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />
    <!-- Do Not Change the HTML title or anything between this line and the line with the 💘's -->
    <title>Home Starter Task</title>
    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />
    <script src="https://pw.sabio.la/api/js/site"></script>
    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>
    <script src="usersService.js"></script>
    <script src="CodeSeven-toastr-50092cc/toastr.js"></script>
    <link href="CodeSeven-toastr-50092cc/build/toastr.css" rel="stylesheet" />

    <!-- #endregion -->
    <!-- I 💘 Code, You 💘 Code, We all 💘 Code -->
    <!-- 💡 All your CSS in here -->
    <style></style>
  </head>

  <body class="sabio bg-light" data-ins="pw-00">
    <!-- Do Not Edit or Remove this nav element -->
    <nav
      class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio"
    ></nav>

    <div class="navbar-container"></div>

    <div id="messageContainer" class="container">
      <h3 id="welcomeMessage">Welcome Guest!</h3>
      <h5 id="instructionMessage">
        Please _login or _register for full access.
      </h5>
    </div>

    <!-- Do Not Edit or Remove this footer element -->
    <footer
      class="do-not-remove container-fluid footer mx-auto fb-targert sabio"
    >
      <p class="text-center">© Sabio.la 2019</p>
    </footer>

    <!--👇🏻 All your JavaScript code goes below here inside this script tag 👇🏻 -->
    <script id="candidateCode">
      function startUp() {
        console.log("start up");
        $(".do-not-remove").addClass("d-none");
        clickHandlers();
        renderPage();
      }
      function clickHandlers() {
        $(".navbar-container").on(
          "click",
          "#logoutSubmitButton",
          onLogoutSubmitButtonClick
        );
        $(".navbar-container").on("click", ".navbar-brand", onSabioIconClick);
      }
      var onLogoutSubmitButtonClick = (e) => {
        e.preventDefault();
        usersService.logout().then(onLogoutSuccess).catch(onLogoutError);
        function onLogoutSuccess(response) {
          console.log(response);
          $(".navbar-container").empty();
          renderNavbar(false);
          renderMessage();
          toastr.success("Logout Successful");
        }
        function onLogoutError(error) {
          console.log(error);
        }
      };
      var onSabioIconClick = (e) => {
        e.preventDefault();
        $(".do-not-remove").toggleClass("d-none");
      };

      var renderPage = () => {
        usersService.current().then(onCheckUserSuccess).catch(onCheckUserError);
        function onCheckUserSuccess(response) {
          console.log(response);
          renderMessage(response.data.item);
          renderNavbar(true, response.data.item.id);
        }
        function onCheckUserError(error) {
          console.log(error);
          renderNavbar(false);
        }
      };
      var renderNavbar = (boolIsLoggedIn, userId) => {
        var navbarHtml = $("#navbarTemplate").html();
        var navbarClone = $(navbarHtml).clone();
        if (!boolIsLoggedIn) {
          $(".navbar-container").append(navbarClone);
        } else {
          $(navbarClone).find("#loginRegisterNav").addClass("d-none");
          $(navbarClone).find("#logoutSubmitButton").removeClass("d-none");
          $(navbarClone).find(".nav-link").removeClass("disabled");
          $(".navbar-container").append(navbarClone);
          usersService
            .getById(userId)
            .then(onGetByIdSuccess)
            .catch(onGetByIdError);
        }
        function onGetByIdSuccess(response) {
          console.log(response);
          $(".navbar-container #userAvatar").attr(
            "src",
            response.data.item.avatarUrl
          );
        }
        function onGetByIdError(error) {
          console.log(error);
        }
      };

      var renderMessage = (currentUserItem) => {
        console.log(currentUserItem);
        if (currentUserItem) {
          $("#welcomeMessage").html(
            `Good to see you again ${currentUserItem.name}!`
          );
          $("#instructionMessage").html("Please use the navigation bar above.");
        } else {
          $("#welcomeMessage").html("Welcome Guest!");
          $("#instructionMessage").html(
            "Please login or register for full access."
          );
        }
      };
    </script>

    <script id="navbarTemplate" type="text/html">
      <nav id="apiNavbar" class="navbar navbar-dark navbar-expand-lg">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">
            <img
              src="/images/Sabio.png"
              alt="sabio logo"
              height="30"
              width="30"
            />
          </a>
        </div>
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a id="blogsNavLink" class="nav-link" href="home.html">Home</a>
          </li>
          <li class="nav-item">
            <a id="friendsNavLink" class="nav-link disabled" href="friends.html"
              >Friends</a
            >
          </li>
          <li class="nav-item">
            <a id="techNavLink" class="nav-link" href="techCompanies.html"
              >Tech Co</a
            >
          </li>
          <li class="nav-item">
            <a id="jobsNavLink" class="nav-link" href="jobs.html">Jobs</a>
          </li>
          <li class="nav-item">
            <a id="eventNavLink" class="nav-link" href="events.html">Events</a>
          </li>
        </ul>
        <ul id="loginRegisterNav" class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="login.html">Login</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="register.html">Register</a>
          </li>
        </ul>
        <div class="ms-auto">
          <button
            id="logoutSubmitButton"
            class="btn btn-danger d-none"
            type="submit"
          >
            Logout
          </button>
          <img
            src="https://bit.ly/3cHWcj3"
            alt="user avatar"
            id="userAvatar"
            height="30"
            width="30"
          />
        </div>
      </nav>
    </script>
    <!-- 🛑 Do Not Write Any Code Below here -->
  </body>
</html>
