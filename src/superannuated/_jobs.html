<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- #region Sabio Code - You can Fold this region to remove it from sight -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="referrer" content="unsafe-url" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png" />
    <link rel="shortcut icon" href="https://sabio.la/Sabio.png" />
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />
    <!-- Do Not Change the HTML title or anything between this line and the line with the ðŸ’˜'s -->
    <title>Jobs</title>
    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />
    <script src="https://pw.sabio.la/api/js/site"></script>
    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>
    <script src="jobsService.js"></script>
    <script src="usersService.js"></script>
    <script src="CodeSeven-toastr-50092cc/toastr.js"></script>
    <link href="CodeSeven-toastr-50092cc/build/toastr.css" rel="stylesheet" />

    <!-- #endregion -->
    <!-- I ðŸ’˜ Code, You ðŸ’˜ Code, We all ðŸ’˜ Code -->

    <!-- ðŸ’¡ All your CSS in here -->
    <style>
      .card {
        width: 15rem;
      }
      .card-img-top {
        height: 200px;
        width: 200px;
      }
      .card-container {
        justify-content: space-evenly;
      }
    </style>
  </head>

  <body class="sabio" data-ins="pw-00">
    <!-- Do Not Edit or Remove this nav element -->
    <nav
      class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio"
    ></nav>

    <nav id="apiNavbar" class="navbar navbar-dark navbar-expand-lg">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">
          <img
            src="/images/Sabio.png"
            alt="sabio logo"
            height="30"
            width="30"
          />
        </a>
      </div>
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a id="blogsNavLink" class="nav-link" href="home.html">Home</a>
        </li>
        <li class="nav-item">
          <a id="friendsNavLink" class="nav-link" href="friends.html"
            >Friends</a
          >
        </li>
        <li class="nav-item">
          <a id="techNavLink" class="nav-link" href="techCompanies.html"
            >Tech Co</a
          >
        </li>
        <li class="nav-item active">
          <a id="jobsNavLink" class="nav-link" href="jobs.html">Jobs</a>
        </li>
        <li class="nav-item">
          <a id="eventNavLink" class="nav-link" href="events.html">Events</a>
        </li>
      </ul>
      <ul id="loginRegisterNav" class="navbar-nav ms-auto d-none">
        <li class="nav-item">
          <a class="nav-link" href="login.html">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="register.html">Register</a>
        </li>
      </ul>
      <button
        id="logoutSubmitButton"
        class="btn btn-danger ms-auto"
        type="submit"
      >
        Logout
      </button>
      <img
        src="https://bit.ly/3cHWcj3"
        alt="user avatar"
        id="userAvatar"
        height="30"
        width="30"
      />
    </nav>

    <div class="container text-center col-6">
      <h3>Plenty of careers below!</h3>
      <a href="jobForm.html">Add a new job.</a>
      <div class="input-group rounded">
        <input
          type="search"
          id="inputSearchJobs"
          class="form-control rounded"
          placeholder="Search"
        />
        <button id="searchJobsButton" type="button" class="btn btn-primary">
          <i class="fas fa-search"></i>
        </button>
      </div>
      <div class="card-container d-flex flex-wrap"></div>
    </div>

    <div
      class="modal fade"
      id="jobInfoModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="jobTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Job Information</h5>
          </div>
          <div class="modal-body">
            <h5 id="jobTitle">Job Title</h5>
            <h6 id="jobSummary">Job Summary</h6>
            <h6 id="jobPay">Job Pay</h6>
            <p id="jobDescription">Job Description</p>
            <ul id="jobSkillsList"></ul>
            <h6 id="techCompanyName">Co Name</h6>
            <p id="techCompanyEmail">Please send resume to:</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              id="closeJobModalButton"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Do Not Edit or Remove this footer element -->
    <footer
      class="do-not-remove container-fluid footer mx-auto fb-targert sabio"
    >
      <p class="text-center">Â© Sabio.la 2019</p>
    </footer>

    <!--ðŸ‘‡ðŸ» All your JavaScript code goes below here inside this script tag ðŸ‘‡ðŸ» -->
    <script id="candidateCode">
      function startUp() {
        console.log("start up");
        $(".do-not-remove").addClass("d-none");
        buttonHandlers();
        renderPage();
      }

      function buttonHandlers() {
        $(".card-container").on("click", ".btn-warning", onEditButtonClick);
        $(".card-container").on("click", ".btn-danger", onDeleteButtonClick);
        $(".card-container").on("click", ".btn-info", onInfoButtonClick);
        $("#searchJobsButton").on("click", onSearchJobsButtonClick);
        $("#closeJobModalButton").on("click", onCloseJobModalButtonClick);
      }
      function onEditButtonClick(e) {
        console.log("edit clicked");
        e.preventDefault();
        //captures id to pass in url.
        var jobId = $(e.target).closest(".card").data("id");
        window.location.href = `jobForm.html?id=${jobId}`;
      }
      function onDeleteButtonClick(e) {
        e.preventDefault();
        jobsService
          .changeStatusId($(this).closest(".card").data("id"), 2)
          .then(onDeleteJobSuccess)
          .catch(onDeleteJobError);
        function onDeleteJobSuccess(response) {
          console.log(response);
          $(e.target).closest(".card").remove();
          toastr.success("Delete Successful.");
        }
        function onDeleteJobError(error) {
          console.log(error);
          toastr.error("Delete Failed.");
        }
      }
      function onInfoButtonClick(e) {
        e.preventDefault();
        var jqSkillsArr = $(this)
          .closest(".card")
          .data("skills")
          .split(",")
          .map((skill) => {
            var skillTemplateHtml = $("#skillListItemTemplate").html();
            var skillTemplateClone = $(skillTemplateHtml).clone();

            $(skillTemplateClone).text(skill);

            return skillTemplateClone;
          });
        console.log(jqSkillsArr);

        $("#jobTitle").text($(this).closest(".card").data("title"));
        $("#jobSummary").text($(this).closest(".card").data("summary"));
        $("#jobPay").text($(this).closest(".card").data("pay"));
        $("#jobDescription").text($(this).closest(".card").data("description"));
        $("#jobSkillsList").append(jqSkillsArr);
        $("#techCompanyName").text(
          $(this).closest(".card").data("company-name")
        );
        $("#techCompanyEmail").text(
          $(this).closest(".card").data("company-email")
        );

        $("#jobInfoModal").modal("toggle");
      }
      function onSearchJobsButtonClick(e) {
        e.preventDefault();
        if ($("#inputSearchJobs").val()) {
          jobsService
            .search(0, 100, $("#inputSearchJobs").val())
            .then(onSearchJobsSuccess)
            .catch(onSearchJobsError);
          function onSearchJobsSuccess(response) {
            console.log(response);
            renderJobs(response.data.item.pagedItems);
          }
          function onSearchJobsError(error) {
            console.logError;
          }
        } else {
          renderPage();
        }
      }
      function onCloseJobModalButtonClick(e) {
        e.preventDefault();
        $("#jobSkillsList").empty();
        $("#jobInfoModal").modal("toggle");
      }

      var renderPage = () => {
        jobsService
          .getPaginated()
          .then(onGetPaginatedSuccess)
          .catch(onGetPaginatedError);
        function onGetPaginatedSuccess(response) {
          console.log(response);
          renderJobs(response.data.item.pagedItems);
        }
        function onGetPaginatedError(error) {
          console.log(error);
        }
      };
      var renderNavbar = () => {};

      var renderJobs = (jobsArray) => {
        $(".card-container").empty();
        var jqJobsArray = jobsArray.map(mapJob);
        $(".card-container").append(jqJobsArray);
      };
      var mapJob = (job) => {
        var cardTemplateHtml = $("#cardTemplate").html();
        var cardClone = $(cardTemplateHtml).clone();
        var skillsArr = job.skills.map((skill) => skill.name);
        var techCoLogoImageArr = job.techCompany.images.filter(
          (image) => image.imageTypeId === "Logo"
        );

        //data for info modal
        $(cardClone).attr("data-id", job.id);
        $(cardClone).attr("data-title", job.title);
        $(cardClone).attr("data-description", job.description);
        $(cardClone).attr("data-summary", job.summary);
        $(cardClone).attr("data-pay", job.pay);
        $(cardClone).attr("data-entity-type-id", job.entityTypeId);
        $(cardClone).attr("data-skills", skillsArr.join());
        $(cardClone).attr("data-company-name", job.techCompany.name);
        $(cardClone).attr(
          "data-company-email",
          job.techCompany.contactInformation.data
        );
        $(cardClone).attr("data-img", techCoLogoImageArr[0].imageUrl);

        //change cards
        $(cardClone).find("img").attr("src", techCoLogoImageArr[0].imageUrl);
        $(cardClone).find(".card-title").text(job.title);
        $(cardClone).find(".card-summary").text(job.summary);

        return cardClone;
      };
    </script>

    <script id="cardTemplate" type="text/html">
      <div class="card shadow-lg">
        <div class="card-header">
          <img
            class="card-img-top"
            src="https://picsum.photos/200"
            alt="primary image"
          />
        </div>
        <div class="card-body text-center">
          <h5 class="card-title">Sample Job Title</h5>
          <p class="card-summary">Sample Summary</p>
          <div class="row">
            <button class="btn btn-info col-4">Info</button>
            <button class="btn btn-warning col-4">Edit</button>
            <button class="btn btn-danger col-4">Delete</button>
          </div>
        </div>
      </div>
    </script>

    <script id="skillListItemTemplate" type="text/html">
      <li class="skill">Skill One</li>
    </script>
    <!-- ðŸ›‘ Do Not Write Any Code Below here -->
  </body>
</html>
