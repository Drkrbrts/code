<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- #region Sabio Code - You can Fold this region to remove it from sight -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="referrer" content="unsafe-url" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png" />
    <link rel="shortcut icon" href="https://sabio.la/Sabio.png" />
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />
    <!-- Do Not Change the HTML title or anything between this line and the line with the ðŸ’˜'s -->
    <title>Friends Starter Task</title>
    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />
    <script src="https://pw.sabio.la/api/js/site"></script>
    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>
    <script src="friendsService.js"></script>
    <script src="usersService.js"></script>
    <script src="CodeSeven-toastr-50092cc/toastr.js"></script>
    <link href="CodeSeven-toastr-50092cc/build/toastr.css" rel="stylesheet" />

    <!-- #endregion -->
    <!-- I ðŸ’˜ Code, You ðŸ’˜ Code, We all ðŸ’˜ Code -->

    <!-- ðŸ’¡ All your CSS in here -->
    <style>
      .card {
        width: 15rem;
      }
      .card-img-top {
        height: 200px;
        width: 200px;
      }
      .clone-container {
        justify-content: space-evenly;
      }
    </style>
  </head>

  <body class="sabio" data-ins="pw-00">
    <!-- Do Not Edit or Remove this nav element -->
    <nav
      class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio"
    ></nav>

    <nav class="navbar navbar-dark navbar-expand-lg">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">
          <img
            src="/images/Sabio.png"
            alt="sabio logo"
            height="30"
            width="30"
          />
        </a>
      </div>
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a id="blogsNavLink" class="nav-link" href="home.html">Home</a>
        </li>
        <li class="nav-item active">
          <a id="friendsNavLink" class="nav-link" href="friends.html"
            >Friends</a
          >
        </li>
        <li class="nav-item">
          <a id="techNavLink" class="nav-link" href="techCompanies.html"
            >Tech Co</a
          >
        </li>
        <li class="nav-item">
          <a id="jobsNavLink" class="nav-link" href="jobs.html">Jobs</a>
        </li>
        <li class="nav-item">
          <a id="eventNavLink" class="nav-link" href="events.html">Events</a>
        </li>
      </ul>
      <ul id="loginRegisterNav" class="navbar-nav d-none">
        <li class="nav-item">
          <a class="nav-link" href="login.html">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="register.html">Register</a>
        </li>
      </ul>
      <div class="ms-auto">
        <button id="logoutSubmitButton" class="btn btn-danger" type="submit">
          Logout
        </button>
        <img
          src="https://bit.ly/3cHWcj3"
          alt="user avatar"
          id="userAvatar"
          height="30"
          width="30"
        />
      </div>
    </nav>

    <div class="container col-6 text-center">
      <h3>All of your friends are here!</h3>
      <a id="addFriendLink" href="friendForm.html">
        <h5>Add a new friend.</h5>
      </a>
      <div class="input-group rounded">
        <input
          type="search"
          id="inputSearchFriends"
          class="form-control rounded"
          placeholder="Search"
        />
        <button id="searchFriendsButton" type="button" class="btn btn-primary">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>

    <div class="clone-container d-flex flex-wrap"></div>

    <!-- Do Not Edit or Remove this footer element -->
    <footer
      class="do-not-remove container-fluid footer mx-auto fb-targert sabio"
    >
      <p class="text-center">Â© Sabio.la 2019</p>
    </footer>

    <!--ðŸ‘‡ðŸ» All your JavaScript code goes below here inside this script tag ðŸ‘‡ðŸ» -->
    <script id="candidateCode">
      function startUp() {
        console.log("start up");
        $(".do-not-remove").addClass("d-none");
        buttonHandlers();
        renderPage();
      }
      function buttonHandlers() {
        $(".clone-container").on("click", ".btn-warning", onEditButtonClick);
        $(".clone-container").on(
          "click",
          ".btn-danger",
          onDeleteFriendButtonClicked
        );
        $("#searchFriendsButton").on("click", onSearchFriendsButtonClick);
      }

      //button functions
      var onEditButtonClick = (e) => {
        console.log("edit clicked");
        e.preventDefault();
        //captures id to pass in url.
        var friendId = $(e.target).closest(".card").data("id");
        window.location.href = `friendForm.html?id=${friendId}`;
      };
      var onDeleteFriendButtonClicked = (e) => {
        e.preventDefault();
        console.log("delete clicked");

        var friendId = $(e.target).closest(".card").data("id");
        friendsService
          .delete(friendId)
          .then(onDeleteSuccess)
          .catch(onDeleteError);

        function onDeleteSuccess(response) {
          console.log(response);
          toastr.success("Successfully deleted _FRIEND");
          $(e.target).closest(".card").remove();
        }
        function onDeleteError(error) {
          console.log(error);
          toastr.error("Failed to delete _FRIEND");
        }
      };
      var onSearchFriendsButtonClick = (e) => {
        e.preventDefault();
        if ($("#inputSearchFriends").val()) {
          friendsService
            .search(0, 100, $("#inputSearchFriends").val())
            .then(onSearchFriendsSuccess)
            .catch(onSearchFriendsError);
          function onSearchFriendsSuccess(response) {
            console.log(response);
            renderCards(response.data.item.pagedItems);
          }
          function onSearchFriendsError(error) {
            console.log(error);
          }
        } else {
          renderPage();
        }
      };

      var renderPage = () => {
        // renderNavbar() to checkUser and add Avatar. if logged off return user to login page.

        friendsService
          .getPaginated()
          .then(onGetPaginatedSuccess)
          .catch(onGetPaginatedError);
        function onGetPaginatedSuccess(response) {
          console.log(response);
          renderCards(response.data.item.pagedItems);
        }
        function onGetPaginatedError(error) {
          console.log(error);
        }
      };
      var renderCards = (arrayOfFriends) => {
        $(".clone-container").empty();
        var jqFriendArray = arrayOfFriends.map(mapFriend);
        $(".clone-container").append(jqFriendArray);
      };
      var mapFriend = (friend) => {
        var cardHtml = $("#cardTemplate").html();
        var cardClone = $(cardHtml).clone();

        cardClone.find(".card-title").html(friend.title);
        cardClone.find(".card-summary").html(friend.summary);
        cardClone.find("img").attr("src", friend.primaryImage.imageUrl);
        cardClone.attr("data-id", friend.id);
        cardClone.attr("data-string", friend.title);

        return cardClone;
      };
    </script>

    <script id="cardTemplate" type="text/html">
      <div class="card shadow-lg">
        <div class="card-header">
          <img
            class="card-img-top"
            src="/images/stock-photos/1.jpg"
            alt="primary image"
          />
        </div>
        <div class="card-body text-center">
          <h5 class="card-title">Sample Friend Title</h5>
          <p class="card-summary">Sample Summary</p>
        </div>
        <div class="row">
          <a href="#" class="btn btn-warning col-5 ms-auto"> Edit </a>
          <a href="#" class="btn btn-danger col-5 me-auto"> Delete </a>
        </div>
      </div>
    </script>

    <!-- ðŸ›‘ Do Not Write Any Code Below here -->
  </body>
</html>
